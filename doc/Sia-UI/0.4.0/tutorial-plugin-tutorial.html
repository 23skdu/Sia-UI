<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Sia-UI tutorialplugin-tutorial</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Sia-UI</a>
	</div>
	<div class="navbar-collapse">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-DaemonAPI.html">DaemonAPI</a></li><li><a href="module-PluginFactory.html">PluginFactory</a></li><li><a href="module-UIConfig.html">UIConfig</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="DaemonManager.html">DaemonManager</a></li><li><a href="Plugin.html">Plugin</a></li><li><a href="PluginManager.html">PluginManager</a></li><li><a href="UIManager.html">UIManager</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-Developers.html">Developers</a></li><li><a href="tutorial-plugin-tutorial.html">plugin-tutorial</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#mainWindow">mainWindow</a></li><li><a href="global.html#startMainWindow">startMainWindow</a></li>
				</ul>
			</li>
			
		</ul>
	</div>
</div>
</div>


<div class="container">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
    		<h1 class="page-title">tutorialplugin-tutorial</h1>
			<section class="tutorial-section">

<header>
    

    <h2>plugin-tutorial</h2>
</header>

<article>
    <h1>Plugins and Sia-UI</h1><p>The new Sia-UI looks a bit lacking, why is that you ask? We steam-rolled the
older version because it felt very hard-coded. This new design allows easy
development of modular parts, called plugins, to interact with our system from
anyone with a little webdev knowledge.</p>
<h2>What is a plugin?</h2><p>A plugin, in the context of Sia-UI, is a self-contained add-on that offers
graphical functionality to interact with the Sia-network. We'll develop plugins
we believe would be widely used, but we're also redesigning Sia-UI to enable
third-party developers interested in our project to make their own plugins.</p>
<p>The structure of a plugin is the exact same as a webpage, with some added
functionality via Node.js &amp; Electron, the core library that supports the Atom
text editor. There are only two hard-rules to a plugin:</p>
<ol>
<li>It must be self-contained in a directory of its name.</li>
<li>It must have an index.html in this directory.</li>
</ol>
<h2>Why plugins?</h2><p>We at NebulousLabs are all about decentralization... of everything! Thus we are
redesigning our GUI desktop application with that in mind. We want the
community interested in the Sia network to be able to:</p>
<ol>
<li>Use Sia-UI in the way they want with only the plugins they care about instead
of using our rigid set of tools.</li>
<li>Be able to design and implement their own plugins.</li>
<li>Customize their own UI experience simply without obfuscating menubars.</li>
</ol>
<p>In the works already is a product that would serve up the locations of files on
the network, not only for optimizing file storage across the world, but for
file-sharing via host-approved listing (think torrents).</p>
<p>We're also designing a GPU-mining software that would efficiently support the
network's transactions.</p>
<p>A third is a blockexplorer that would allow developers and prospectors alike to
understand and watch the flow of the network's coins, files, etc.</p>
<p>These are all products that we don't want to include with every Sia-UI
distribution so it makes sense to dynamically load them with the UI.</p>
<h1>How to write a plugin</h1><h2>It's a webpage... it's that simple.</h2><p>Plugins are loaded into Sia-UI on run-time through an electron utility called
the <a href="http://electron.atom.io/docs/v0.29.0/api/web-view-tag/">web-view tag</a>.
These tags open up the viewing of guest content by pointing to an HTML file
that displays the rest of the plugin, importing CSS, Javascript as is usually
done in a webpage.</p>
<p>One could make a plugin that views Github.com by making a folder
<code>app/plugins/Github</code> and placing a one-line index.html file:
<code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=http://Github.com/&quot; /&gt;</code>
Suddenly, there's a button labeled 'Github' and upon click, shows <img src="/doc/assets/github-plugin.png" alt="Note:
Though this is currently a bit buggy due to sites using global variables that
conflict with nodeintegration being turned on."></p>
<h2>Making a Sidebar Button</h2><p>However, we don't want developers to launch a webpage on a server just to make
a plugin. We're trying to make a basic plugin that serves an actual function.
For this, we'll go through implementing the Overview plugin.</p>
<p>Plugins are loaded dynamically based on the folders in the /app/plugins
directory. The sidebar is handled on our part so plugins only need a properly
placed png file and folder name for a button. </p>
<p>The plugin directory should now be:</p>
<pre class="prettyprint source lang-text"><code>Sia-UI/app/plugins/Overview/
└── assets/
    └── button.png</code></pre><p>The Overview uses the 'bars' <a href="http://fa2png.io/">font awesome icon in png form</a>.
Loading up Sia-UI again, we'll see: <img src="/doc/assets/sidebar.png" alt="Impressive plugin ain't
it?"></p>
<h2>Making a Mainbar View</h2><p>Now to insert some content for our plugin. The overview plugin will be the home
plugin for most everyone, so we'll add a nice little greeting and title to it:</p>
<pre class="prettyprint source lang-html"><code>&lt;!DOCTYPE html>
&lt;html>
    &lt;head>
    &lt;/head>
    &lt;body>
        &lt;!-- Header -->
        &lt;div class='header'>
            &lt;div class='title' id='title'>Overview&lt;/div>
        &lt;/div>

        &lt;!-- Frame -->
        &lt;div class='frame'>
            &lt;div class='welcome'>
                &lt;div class='large'>Welcome to Sia&lt;/div>
                &lt;div class='small'>A highly efficient decentralized storage network.&lt;/div>
            &lt;/div>
        &lt;/div>
    &lt;/body>
&lt;/html></code></pre><p>We've got how our users will be greeted upon entering the UI, now we should
determine what information should be regularly viewed upon entry by most every
user. Inspired by the previous UI, we pick the block height, peer count, and
wallet balance. The first lets the user know they're up to date with the
blockchain. The second lets the user further know that they're connected with
other people on the network. Lastly each and every user, whether they host,
rent, or mine, will probably have some balance of Siacoin.</p>
<p>We'll add a containing div, let's call it 'capsule' for our header section and
div fields for each of these to our index.html, keeping them all the same class
name, say 'pod' so that we can later style them alike CSS while giving them
unique id's to update each of them separately later in JS.</p>
<pre class="prettyprint source lang-html"><code>        &lt;!-- Header -->
        &lt;div class='header'>
            &lt;div class='title' id='title'>Overview&lt;/div>
            &lt;div class='capsule'>
                &lt;div class='pod' id='balance'>Balance: 0&lt;/div>
                &lt;div class='pod' id='peers'>Peers: 0&lt;/div>
                &lt;div class='pod' id='block-height'>Block Height: 0&lt;/div>
            &lt;/div>
        &lt;/div></code></pre><p>The plugin directory should now be:</p>
<pre class="prettyprint source lang-text"><code>Sia-UI/app/plugins/Overview/
├── index.html
└── assets/
    └── button.png</code></pre><p>Loading up Sia-UI again, we'll see: <img src="/doc/assets/basic-overview.png" alt="Impressive plugin ain't it?"></p>
<h2>Styling the View</h2><p>Now that we have mock data to display to our user, we want this view to start
taking shape, form, and last-but-not-least, style! The UI has a font that we
use for the sidebar buttons called roboto condensed, so let's just copy paste
that into our folder so our plugin remains modular.</p>
<p>From terminal at the Sia-UI root directory:</p>
<pre class="prettyprint source lang-bash"><code>cp app/assets/roboto-condensed-min.css app/plugins/Overview/assets</code></pre><p>Then we're going to need the plugin's index.html to know about this font and
our custom plugin CSS through adding two lines in the head section:</p>
<pre class="prettyprint source lang-html"><code>    &lt;head>
        &lt;!-- CSS -->
        &lt;link rel='stylesheet' href='assets/roboto-condensed-min.css'>
        &lt;link rel='stylesheet' href='css/overview.css'>
    &lt;/head></code></pre><p>With a cool font, we need a cool layout. The following css was adopted from the
old Sia-UI and we'll throw it in a css folder in our plugin directory. We're
skimming over this because it's not too important to review in this particular
guide.</p>
<pre class="prettyprint source lang-css"><code>/*    Style Guide:
 *        Transparent: 70% Opacity
 *
 *         White:      #FFFFFF
 *         Grey-White: #F5F5F5
 *        Faint-Grey: #ECECEC
 *        Light-Grey: #DDDDDD
 *        Grey:       #C5C5C5
 *         Grey-Black: #4A4A4A
 *         Black:      #000000
 */
body {
    margin: 0px;
    padding: 0px;
    border-spacing: 0px;
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 300;
    font-size: 18px;
}
.header {
    opacity: .7;
    padding: 20px;
    border-bottom: 2px solid #f5f5f5;
    background-color: #4a4a4a;
    color: #fff;
    height: 50px;
    vertical-align: top;
}
.header .title {
    display: inline-block;
    font-size: 32px;
    color: #fff;
}
.header .capsule {
    float: right;
}
.capsule {
    display: inline-block;
    border: 1px solid #ffffff;
    border-radius: 4px;
    overflow: hidden;
}
.capsule .pod {
    display: inline-block;
    padding: 10px;
    padding-left: 16px;
    padding-right: 16px;
    border-right: 1px solid #ffffff;
    color: #f5f5f5;
}
.capsule .pod:last-child {
    border: none;
    padding-right: 20px;
}
.frame {
    color: #f5f5f5;
    font-size: 32px;
    padding-top: 18px;
    padding-bottom: 0px;
    padding-left: 30px;
    padding-right: 16px;
}
.frame .text {
    color: #c5c5c5;
}
.welcome {
    margin-top: 50px;
    text-align: center;
}
.welcome .large {
    font-size: 72px;
    color: #c5c5c5;
}
.welcome .small {
    margin-top: 20px;
    font-size: 32px;
    color: #c5c5c5;
}</code></pre><p>Quite a lot to take in without review, but that's how styling webpages goes. </p>
<p>The plugin directory should reflect our css files:</p>
<pre class="prettyprint source lang-text"><code>Sia-UI/app/plugins/Overview/
├── index.html
├── assets/
│   ├── button.png
│   └── roboto-condensed-min.css
└── css/
    └── overview.css</code></pre><p>Loading up Sia-UI again, we'll see: <img src="/doc/assets/styled-overview.png" alt="Impressive plugin ain't it?"></p>
<h2>Updating our View</h2><p>Now we need to make a JS file to contain logic to fill these data fields. First
let's include the JS file-to-be-made in our index.html at the bottom to load
and fill our fields after the general skeleton has been parsed.</p>
<pre class="prettyprint source lang-html"><code>        &lt;!-- JS -->
        &lt;script type='text/javascript' src='js/overview.js'>&lt;/script>
    &lt;/body>
&lt;/html></code></pre><p>After we make such a javascript file, we should cover the additional tools
Sia-UI gives to its plugins beyond just a sidebar-button.</p>
<h3>IPC</h3><p>We must first understand that plugins, due to their webview nature, run in a
separate process with different permissions than the general UI. This is so
plugin behavior is very controlled and encapsulated. Commmunication between it
and the UI will be through an asynchronous electron library tool called 'ipc' or
'inter-process-communication'. Thus, the top of our file should contain:</p>
<pre class="prettyprint source lang-js"><code>'use strict';
// Library for communicating with Sia-UI
const IPC = require('ipc');</code></pre><p>Asynchronous messages sent through ipc are picked up based on their channels.
On can send primitives, objects, or nothing at all through these channels and
the UI reacts accordingly. For example, turn chromium devtools on using:</p>
<pre class="prettyprint source lang-js"><code>IPC.sendToHost('devtools');</code></pre><p>It's like a mini API but the UI currently registers only 'devtools', and
'api-call' channels. For more detail, see app/js/pluginManager.js</p>
<h3>Making API calls</h3><p>To send api calls through the UI to a hosted siad, call ipc's sendToHost()
function along the message channel 'api-call' and pass in the string of the
call address (for GET calls only).</p>
<pre class="prettyprint source lang-js"><code>function callAPI() {
    IPC.sendToHost('api-call', '/wallet/status');
    IPC.sendToHost('api-call', '/gateway/status');
    IPC.sendToHost('api-call', '/consensus/status');
}</code></pre><p>To do something with the result of said calls, one has to listen on the IPC
channel corresponding to the call string.</p>
<pre class="prettyprint source lang-js"><code>// Update values per call
IPC.on('/wallet/status', function(err, result) {
    document.getElementById('balance').innerHTML = 'Balance: ' + result.Balance;
});
IPC.on('/gateway/status', function(err, result) {
    document.getElementById('peers').innerHTML = 'Peers: ' + result.Peers.length;
});
IPC.on('/consensus/status', function(err, result) {
    document.getElementById('block-height').innerHTML = 'Block Height: ' + result.Height;
});</code></pre><h3>Plugin Lifecycle</h3><p>Currently, the UI checks for and executes a function called init() upon loading
and kill() upon transitioning away from said function. Thus a plugin needs to
initialize and update its fields based on these two functions, even though it
continues to exist in the background when another view is shown.</p>
<p>A good way to do this is to have a global variable that points to a function
being executed periodically using native Javascript's setInterval().</p>
<pre class="prettyprint source lang-js"><code>// Keeps track of if the view is shown
var updating;

function init() {
    // DEVTOOL: uncomment to bring up devtools on plugin view
    // IPC.sendToHost('devtools');

    // Call the API regularly to update page
    updating = setInterval(callAPI, 1000);
}

function kill() {
    clearInterval(updating);
}</code></pre><h3>Usability</h3><p>This all functions well enough, but it's a bit of an amateur design when one
actually uses the plugin. Numbers are jerky and we see a large amount of
numbers for our balance since it's in 10^-24 Siacoin, or what we call
baseunits, similar to Bitcoin and satoshis. Thus, we'll hack up a quick
function to represent kilosiacoin balances to our users:</p>
<pre class="prettyprint source lang-js"><code>function formatKSiacoin(baseUnits, precision) {
    if (!precision) {
        precision = 10;
    }

    var ksiaConversionFactor = Math.pow(10,27);
    var display = parseFloat((baseUnits/ksiaConversionFactor).toFixed(1));

    // Indicate if the user has some value with a last digit of '1'
    if (baseUnits > 0 && string === parseFloat((0).toFixed(1))) {
        string = parseFloat((0).toFixed(precision).substring(0,precision-1) + '1');
    }

    return display + ' KS';
}</code></pre><p>We should have global variables that are updated and not just update the markup
directly, so as to maintain non-initial values and avoid that 0 to actual
number jerk each and every time a user opens up our plugin.</p>
<pre class="prettyprint source lang-js"><code>// Variables to store api result values
var balance = 0;
var peerCount = 0;
var blockHeight = 0;

// Update values per call
IPC.on('/wallet/status', function(err, result) {
    balance = formatKSiacoin(result.Balance) || balance;
    document.getElementById('balance').innerHTML = 'Balance: ' + balance;
});
IPC.on('/gateway/status', function(err, result) {
    peerCount = result.Peers.length || peerCount;
    document.getElementById('peers').innerHTML = 'Peers: ' + peerCount;
});
IPC.on('/consensus/status', function(err, result) {
    blockHeight = result.Height || blockHeight;
    document.getElementById('block-height').innerHTML = 'Block Height: ' + blockHeight;
});</code></pre><p>Finally, the aggregated Javascript code should look like this:</p>
<pre class="prettyprint source"><code>'use strict';
// Library for communicating with Sia-UI
const IPC = require('ipc');
// Variables to store api result values
var balance = 0;
var peerCount = 0;
var blockHeight = 0;
// Keeps track of if the view is shown
var updating;

function callAPI() {
    IPC.sendToHost('api-call', '/wallet/status');
    IPC.sendToHost('api-call', '/gateway/status');
    IPC.sendToHost('api-call', '/consensus/status');
}

function formatKSiacoin(baseUnits, precision) {
    if (!precision) {
        precision = 10;
    }

    var ksiaConversionFactor = Math.pow(10,27);
    var display = parseFloat((baseUnits/ksiaConversionFactor).toFixed(1));

    // Indicate if the user has some value with a last digit of '1'
    if (baseUnits > 0 && string === parseFloat((0).toFixed(1))) {
        string = parseFloat((0).toFixed(precision).substring(0,precision-1) + '1');
    }

    return display + ' KS';
}

// Update values per call
IPC.on('/wallet/status', function(err, result) {
    balance = formatKSiacoin(result.Balance) || balance;
    document.getElementById('balance').innerHTML = 'Balance: ' + balance;
});
IPC.on('/gateway/status', function(err, result) {
    peerCount = result.Peers.length || peerCount;
    document.getElementById('peers').innerHTML = 'Peers: ' + peerCount;
});
IPC.on('/consensus/status', function(err, result) {
    blockHeight = result.Height || blockHeight;
    document.getElementById('block-height').innerHTML = 'Block Height: ' + blockHeight;
});

function init() {
    // DEVTOOL: uncomment to bring up devtools on plugin view
    // IPC.sendToHost('devtools');

    // Call the API regularly to update page
    updating = setInterval(callAPI, 1000);
}

function kill() {
    clearInterval(updating);
}</code></pre><pre class="prettyprint source lang-text"><code>Sia-UI/app/plugins/Overview/
├── index.html
├── assets/
│   ├── button.png
│   └── roboto-condensed-min.css
├── css/
│   └── overview.css
└── js/
    └── overview.js</code></pre><p>Loading up Sia-UI again, we'll all see something different because the numbers
should be pulled from the API and one's siad-state. In our case, the view shows
the highly active dev network:
<img src="/doc/assets/dev-overview.png" alt="Impressive plugin ain't it?"></p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


<footer>

	NebulousLabs
	<br />


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>
	on 07/26/2015 using the <a
	href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
</span>
</footer>

<!--<script src="scripts/sunlight.js"></script>-->
<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/bootstrap-dropdown.js"></script>
<script src="scripts/toc.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "h1,h2,h3,h4",
		showAndHide : false,
		scrollTo    : "100px"
	} );

	$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();
	//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			lang = "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );
} );
</script>



<!--Navigation and Symbol Display-->

<script>
	$( function () {
		$( '#main' ).localScroll( {
			offset : { top : 60 } //offset by the height of your header (give or take a few px, see what works for you)
		} );
		$( "dt.name" ).each( function () {
			var $this = $( this ).find("h4");
			var icon = $( "<i/>" ).addClass( "icon-plus-sign" ).addClass( "pull-right" ).addClass( "icon-white" );
			var dt = $(this);
			var children = dt.next( "dd" );

			dt.prepend( icon ).css( {cursor : "pointer"} );
			dt.addClass( "member-collapsed" ).addClass( "member" );


			children.hide();

			dt.children().on( "click", function () {
				children = dt.next( "dd" );
				children.slideToggle( "fast", function () {

					if ( children.is( ":visible" ) ) {
						icon.addClass( "icon-minus-sign" ).removeClass( "icon-plus-sign" ).removeClass( "icon-white" );
						dt.addClass( "member-open" ).animate( "member-collapsed" );
					} else {
						icon.addClass( "icon-plus-sign" ).removeClass( "icon-minus-sign" ).addClass( "icon-white" );
						dt.addClass( "member-collapsed" ).removeClass( "member-open" );
					}
				} );
			} );

		} );
	} );
</script>


<!--Google Analytics-->


</body>
</html>